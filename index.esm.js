var W=Object.defineProperty;var K=(e,n)=>{for(var x in n)W(e,x,{get:n[x],enumerable:!0})};var q={};K(q,{FREQUENCY:()=>y,Intervals:()=>w,MASTER_TUNE:()=>Q,NoteNumbers:()=>G,WORK_INTERVAL:()=>B});var B=.1,Q=440,y=Array(128).fill(void 0).map((e,n)=>440*Math.pow(2,(n-69)/12)),G;(t=>(t.C0=12,t.Cs0=13,t.Db0=13,t.D0=14,t.Ds0=15,t.Eb0=15,t.E0=16,t.Es0=17,t.Fb0=16,t.F0=17,t.Fs0=18,t.Gb0=18,t.G0=19,t.Gs0=20,t.Ab0=20,t.A0=21,t.As0=22,t.Bb0=22,t.B0=23,t.Bs0=24,t.Cb1=23,t.C1=24,t.Cs1=25,t.Db1=25,t.D1=26,t.Ds1=27,t.Eb1=27,t.E1=28,t.Es1=29,t.Fb1=28,t.F1=29,t.Fs1=30,t.Gb1=30,t.G1=31,t.Gs1=32,t.Ab1=32,t.A1=33,t.As1=34,t.Bb1=34,t.B1=35,t.Bs1=36,t.Cb2=35,t.C2=36,t.Cs2=37,t.Db2=37,t.D2=38,t.Ds2=39,t.Eb2=39,t.E2=40,t.Es2=41,t.Fb2=40,t.F2=41,t.Fs2=42,t.Gb2=42,t.G2=43,t.Gs2=44,t.Ab2=44,t.A2=45,t.As2=46,t.Bb2=46,t.B2=47,t.Bs2=48,t.Cb3=47,t.C3=48,t.Cs3=49,t.Db3=49,t.D3=50,t.Ds3=51,t.Eb3=51,t.E3=52,t.Es3=53,t.Fb3=52,t.F3=53,t.Fs3=54,t.Gb3=54,t.G3=55,t.Gs3=56,t.Ab3=56,t.A3=57,t.As3=58,t.Bb3=58,t.B3=59,t.Bs3=60,t.Cb4=59,t.C4=60,t.Cs4=61,t.Db4=61,t.D4=62,t.Ds4=63,t.Eb4=63,t.E4=64,t.Es4=65,t.Fb4=64,t.F4=65,t.Fs4=66,t.Gb4=66,t.G4=67,t.Gs4=68,t.Ab4=68,t.A4=69,t.As4=70,t.Bb4=70,t.B4=71,t.Bs4=72,t.Cb5=71,t.C5=72,t.Cs5=73,t.Db5=73,t.D5=74,t.Ds5=75,t.Eb5=75,t.E5=76,t.Es5=77,t.Fb5=76,t.F5=77,t.Fs5=78,t.Gb5=78,t.G5=79,t.Gs5=80,t.Ab5=80,t.A5=81,t.As5=82,t.Bb5=82,t.B5=83,t.Bs5=84,t.Cb6=83,t.C6=84,t.Cs6=85,t.Db6=85,t.D6=86,t.Ds6=87,t.Eb6=87,t.E6=88,t.Es6=89,t.Fb6=88,t.F6=89,t.Fs6=90,t.Gb6=90,t.G6=91,t.Gs6=92,t.Ab6=92,t.A6=93,t.As6=94,t.Bb6=94,t.B6=95,t.Bs6=96,t.Cb7=95,t.C7=96,t.Cs7=97,t.Db7=97,t.D7=98,t.Ds7=99,t.Eb7=99,t.E7=100,t.Es7=101,t.Fb7=100,t.F7=101,t.Fs7=102,t.Gb7=102,t.G7=103,t.Gs7=104,t.Ab7=104,t.A7=105,t.As7=106,t.Bb7=106,t.B7=107,t.Bs7=108,t.Cb8=107,t.C8=108,t.Cs8=109,t.Db8=109,t.D8=110,t.Ds8=111,t.Eb8=111,t.E8=112,t.Es8=113,t.Fb8=112,t.F8=113,t.Fs8=114,t.Gb8=114,t.G8=115,t.Gs8=116,t.Ab8=116,t.A8=117,t.As8=118,t.Bb8=118,t.B8=119,t.Bs8=120,t.Cb9=119,t.C9=120,t.Cs9=121,t.Db9=121,t.D9=122,t.Ds9=123,t.Eb9=123,t.E9=124,t.Es9=125,t.Fb9=124,t.F9=125,t.Fs9=126,t.Gb9=126,t.G9=127))(G||={});var w;(d=>(d.maj=[0,4,7],d.min=[0,3,7],d.sus4=[0,5,7],d.sus2=[0,2,7],d.aug=[0,4,8],d.dim=[0,3,6],d.six=[9],d.min7=[10],d.maj7=[11],d.add9=[14],d.add11=[17],d.add13=[19],d.major=[0,2,4,5,7,9,11],d.minor=[0,2,3,5,6,8,11],d.harmonicmin=[0,2,3,5,7,8,11],d.melodicmin=[0,2,3,5,7,9,11],d.ionian=[0,2,4,5,7,9,11],d.dorian=[0,2,3,5,7,9,10],d.phrygian=[0,1,3,5,7,8,10],d.lydian=[0,2,4,6,7,9,11],d.mixolydian=[0,2,4,5,7,9,10],d.aeolian=[0,2,3,5,7,8,10],d.locrian=[0,1,3,5,6,8,10],d.wholetone=[0,2,4,6,8,10]))(w||={});var Y=e=>n=>{let{source:x,sequence:r,duration:p}=n,s=!1,c=0,h=0,a=0,i=(l,S)=>{let g=[];return l.forEach(A=>{A instanceof Array?g.push(...i(A,S/A.length)):g.push({step:A,value:S})}),g},E=r({...e.timing,loopCount:a}),o=i(E,1/E.length);return{get isActivated(){return s},set isActivated(l){s=l},get nextScheduleTime(){return c},set nextScheduleTime(l){c=l},get currentStep(){return h},schedule:(l,S)=>{let g=S*p;if(s)for(;l+.1>c;){let{step:A,value:D}=o[h];A&&[A.noteNumber].flat().forEach(T=>{x.play({noteNumber:T,startTime:c,volume:A.volume??1,duration:g*D*A.duration})}),c+=g*D,h++,h>=o.length&&(h=0,a++,o=i(r({...e.timing,loopCount:a}),1/E.length))}},source:x,sequence:r,duration:p}},M=Y;var F=e=>(n,x,r,p)=>{let{attack:s,decay:c,sustain:h,release:a}=p,i=e.createGain(),E=s/1e3,o=c/1e3,f=a/1e3;i.gain.linearRampToValueAtTime(0,n),i.gain.linearRampToValueAtTime(x,n+E),i.gain.linearRampToValueAtTime(x*h,n+E+o);let l=r+f;return i.gain.linearRampToValueAtTime(0,n+E+o+l),i};var C=e=>(n=[{type:"sawtooth",detune:0,semitone:0}])=>({play:r=>{let{noteNumber:p,startTime:s,duration:c,volume:h}=r,a=r.adsr??{attack:0,decay:0,sustain:1,release:0};n.forEach(i=>{let E=F(e)(s,h,c,a);E.connect(e.destination);let o=new OscillatorNode(e,{type:i.type,detune:i.detune,frequency:y[p+i.semitone]});o.start(s),o.stop(s+c+(a?a.release/1e3:0)),o.connect(E)})}});var k=(e,n=1,x=1)=>({noteNumber:e,volume:n,duration:x});var _=({tempo:e=128,beatsParCycle:n=8})=>{let x=new AudioContext,r=60/e,p=0,s=new Map,c=0,h=()=>{for(;x.currentTime+.1>c;)p%n===0&&(console.log("---------------------"),s.forEach(o=>{o.isActivated||(o.isActivated=!0,o.nextScheduleTime=c)})),console.log({beatCount:p}),p++,c+=r;s.forEach(o=>{o.schedule(x.currentTime,r)})},a,i=()=>{a=window.setInterval(h,.1*1e3)},E=()=>clearInterval(a);return i(),{audioContext:x,tempo:e,beatsParCycle:n,beatLength:r,spells:s,beatCount:p,start:i,stop:E,get timing(){return{cycles:Math.floor(p/n),beats:p%n}},cast(o,f){let l=r*(n-p%n)*1e3-50;if(console.log({delay:l,beat:p%n}),f==null){window.setTimeout(()=>{s.delete(o)},l);return}let S=M(this)(f);window.setTimeout(()=>{s.set(o,S)},l)},useMetrognome(o=!0){if(o){let f=C(this.audioContext)([{type:"square",detune:0,semitone:0}]),l=({beats:g})=>[k(g===0?G.A6:G.A5,1,.2)],S=1;console.log({source:f,sequence:l,duration:S}),this.cast("metrognome",{source:f,sequence:l,duration:S})}else this.cast("metrognome",null)}}};var R=e=>n=>(x,r=1,p=1,s=!1)=>{let c=[],h=x.split("");for(let a=0;a<h.length;a++){let i=h[a],E=parseInt(i,16);if(!isNaN(E)){c.push({noteNumber:n[E],volume:p,duration:r});continue}if(!s){if(i==" "){c.push(null);continue}if(i=="."){let o=c.findLastIndex(f=>f!=null);o>=0?c.push(c[o]):c.push(null);continue}if(i=="?"){let o=e(0,n.length-1);c.push({noteNumber:n[o],volume:p,duration:r});continue}if(i=="-"){let o=c.findLastIndex(f=>f!=null);o>=0&&(c[o].duration+=r),c.push(null);continue}if(i=="["){let o=L("[",x,a);if(o>=0){let f=R(e)(n)(h.slice(a+1,o).join(""),r/(o-a-1),p);c.push(f),a=o}continue}if(i=="{"){let o=L("{",x,a);if(o>=0){let f=R(e)(n)(h.slice(a+1,o).join(""),r,p,!0).map(l=>l==null||Array.isArray(l)?null:l?.noteNumber).filter(l=>l!=null);c.push({noteNumber:f,volume:p,duration:r}),a=o}continue}}}return c},H={"[":"]","{":"}"},L=(e,n,x)=>{let r=0;for(let p=x;p<n.length;p++)if(n[p]==e&&r++,n[p]==H[e]&&(r--,r<=0))return p;return-1};var J=e=>async n=>{let x=n.map(async s=>fetch(s).then(c=>c.arrayBuffer()).then(async c=>await e.decodeAudioData(c))),r=await Promise.allSettled(x).then(s=>s.map(c=>c.status==="fulfilled"?c.value:null));return{play:s=>{let{noteNumber:c,startTime:h,duration:a,volume:i}=s,E=s.adsr??{attack:0,decay:0,sustain:1,release:0},o=F(e)(h,i,a,E),f=e.createBufferSource();if(f.buffer=r[c],f.buffer!=null){let l=f.buffer.duration;o.connect(e.destination),f.connect(o),f.start(h),f.stop(h+l+E.release/1e3)}}}};var X=(e,...n)=>{let x=new Set(n.flat().flat()),r=[];return x.forEach(p=>{r.push(e+p)}),r};function*Z(e=88675123){let n=123456789,x=362436069,r=521288629,p=e;for(;;){let s=n^n<<11;n=x,x=r,r=p,p=p^p>>>19^(s^s>>>8),yield(p+2147483647)/4294967296}}var $=e=>(n=0,x=9)=>Math.floor(e.next().value*(x+1-n))+n;var qc=_;export{Z as RNG,q as constant,J as createSampler,X as createScale,R as createSequence,C as createSynth,qc as default,$ as getRandomInt};
